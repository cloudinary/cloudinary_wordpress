(()=>{var e={"./node_modules/@wordpress/api-fetch/build-module/index.js":()=>{throw new Error("Module build failed: Error: ENOENT: no such file or directory, open '/Users/gabriel/Local Sites/cloudinary/app/public/wp-content/plugins/cloudinary_wordpress/node_modules/@wordpress/api-fetch/build-module/index.js'")},"./node_modules/@wordpress/i18n/build-module/index.js":()=>{throw new Error("Module build failed: Error: ENOENT: no such file or directory, open '/Users/gabriel/Local Sites/cloudinary/app/public/wp-content/plugins/cloudinary_wordpress/node_modules/@wordpress/i18n/build-module/index.js'")},"./node_modules/file-size/index.js":(e,t)=>{var n,a,i,s;s=function(){var e="BKMGTPEZY".split("");function t(e,t){return e&&e.toLowerCase()===t.toLowerCase()}return function(n,a){return n="number"==typeof n?n:0,(a=a||{}).fixed="number"==typeof a.fixed?a.fixed:2,a.spacer="string"==typeof a.spacer?a.spacer:" ",a.calculate=function(e){var i=t(e,"si")?["k","B"]:["K","iB"],s=t(e,"si")?1e3:1024,d=Math.log(n)/Math.log(s)|0,l=n/Math.pow(s,d),o=l.toFixed(a.fixed);return d-1<3&&!t(e,"si")&&t(e,"jedec")&&(i[1]="B"),{suffix:d?(i[0]+"MGTPEZY")[d-1]+i[1]:1==(0|o)?"Byte":"Bytes",magnitude:d,result:l,fixed:o,bits:{result:l/8,fixed:(l/8).toFixed(a.fixed)}}},a.to=function(a,i){var s=t(i,"si")?1e3:1024,d=e.indexOf("string"==typeof a?a[0].toUpperCase():"B"),l=n;if(-1===d||0===d)return l.toFixed(2);for(;d>0;d--)l/=s;return l.toFixed(2)},a.human=function(e){var t=a.calculate(e);return t.fixed+a.spacer+t.suffix},a}},e.exports?e.exports=s():(a=[],void 0===(i="function"==typeof(n=s)?n.apply(t,a):n)||(e.exports=i))},"./src/js/components/onoff.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var a=n("./node_modules/file-size/index.js"),i=n.n(a);const s={controlled:null,bind(e){this.controlled=e,this.controlled.forEach(e=>{this._main(e)}),this._init()},_init(){this.controlled.forEach(e=>{this._checkUp(e)})},_main(e){const t=JSON.parse(e.dataset.main);e.dataset.size&&(e.filesize=parseInt(e.dataset.size,10)),e.mains=t.map(t=>{const n=document.getElementById(t),a=document.getElementById(t+"_size_wrapper");return a&&(n.filesize=0,n.sizespan=a),this._addChild(n,e),n}),this._bindEvents(e),e.mains.forEach(e=>{this._bindEvents(e)})},_bindEvents(e){e.eventBound||(e.addEventListener("click",t=>{const n=t.target;n.elements&&(this._checkDown(n),this._evaluateSize(n)),n.mains&&this._checkUp(e)}),e.eventBound=!0)},_addChild(e,t){const n=e.elements?e.elements:[];-1===n.indexOf(t)&&(n.push(t),e.elements=n)},_removeChild(e,t){const n=e.elements.indexOf(t);-1<n&&e.elements.splice(n,1)},_checkDown(e){e.elements&&(e.classList.remove("partial"),e.elements.forEach(t=>{t.checked!==e.checked&&(t.checked=e.checked,t.disabled&&(t.checked=!1),t.dispatchEvent(new Event("change")))}),e.elements.forEach(t=>{this._checkDown(t),t.elements||this._checkUp(t,e)}))},_checkUp(e,t){e.mains&&[...e.mains].forEach(e=>{e!==t&&this._evaluateCheckStatus(e),this._checkUp(e),this._evaluateSize(e)})},_evaluateCheckStatus(e){let t=0,n=e.classList.contains("partial");n&&(e.classList.remove("partial"),n=!1),e.elements.forEach(a=>{null!==a.parentNode?(t+=a.checked,a.classList.contains("partial")&&(n=!0)):this._removeChild(e,a)});let a="some";t===e.elements.length?a="on":0===t?a="off":n=!0,n&&e.classList.add("partial");const i="off"!==a;e.checked===i&&e.value===a||(e.value=a,e.checked=i,e.dispatchEvent(new Event("change")))},_evaluateSize(e){if(e.sizespan&&e.elements){e.filesize=0,e.elements.forEach(t=>{t.checked&&(e.filesize+=t.filesize)});let t=null;0<e.filesize&&(t=i()(e.filesize,{spacer:" "}).human("jedec")),e.sizespan.innerText=t}}}},"./src/js/components/states.js":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});const a={key:"_cld_pending_state",data:null,pending:null,changed:!1,previous:{},init(){this.data=cldData.stateData?cldData.stateData:{};let e=localStorage.getItem(this.key);e&&(e=JSON.parse(e),this.data={...this.data,...e},this.sendStates()),this.previous=JSON.stringify(this.data)},_update(){this.pending&&(clearTimeout(this.pending),localStorage.removeItem(this.key)),this.previous!==JSON.stringify(this.data)&&(this.pending=setTimeout(()=>this.sendStates(),2e3),localStorage.setItem(this.key,JSON.stringify(this.data)))},set(e,t){this.data[e]&&this.data[e]===t||(this.data[e]=t,this._update())},get(e){let t=null;return this.data[e]&&(t=this.data[e]),t},sendStates(){fetch(cldData.stateURL,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":cldData.stateNonce},body:JSON.stringify(this.data)}).then(e=>e.json()).then(e=>{e.success&&(this.previous=JSON.stringify(e.state),localStorage.removeItem(this.key))})}}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};(()=>{"use strict";n.r(a);var e=n("./node_modules/@wordpress/api-fetch/build-module/index.js"),t=n("./node_modules/@wordpress/i18n/build-module/index.js"),i=n("./src/js/components/onoff.js"),s=n("./src/js/components/states.js");const d={cachePoints:{},spinners:{},states:null,init(t,n){if(this.states=n,"undefined"!=typeof CLDASSETS){e.default.use(e.default.createNonceMiddleware(CLDASSETS.nonce));t.querySelectorAll("[data-cache-point]").forEach(e=>this._bind(e));const n=document.getElementById("connect.cache.cld_purge_all");n&&(n.disabled="disabled",n.style.width="100px",n.style.transition="width 0.5s",n.addEventListener("click",()=>{n.dataset.purging||confirm(wp.i18n.__("Purge entire cache?","cloudinary"))&&this._purgeAll(n,!1)}),this._watchPurge(n),setInterval(()=>{this._watchPurge(n)},5e3))}},getCachePoint(e){return this.cachePoints["_"+e]?this.cachePoints["_"+e]:null},setCachePoint(e,t){const n=document.getElementById(t.dataset.slug),a=document.createElement("div"),i=this._getRow(),s=document.createElement("td");s.colSpan=2,s.className="cld-loading",i.appendChild(s);const d=document.getElementById(t.dataset.slug+"_search"),l=document.getElementById(t.dataset.slug+"_reload"),o=document.getElementById(t.dataset.browser),c=document.getElementById(t.dataset.apply);c.style.float="right",c.style.marginLeft="6px",o.addEventListener("change",t=>{this._handleManager(e)}),n.addEventListener("change",t=>{this._handleManager(e)}),window.addEventListener("CacheToggle",e=>{e.detail.cachePoint===t&&this._cacheChange(t,e.detail)}),c.addEventListener("click",e=>{this._applyChanges(t)}),l.addEventListener("click",t=>{this._load(e)}),d.addEventListener("keydown",t=>{13===t.which&&(t.preventDefault(),t.stopPropagation(),this._load(e))}),a.className="cld-pagenav",c.cacheChanges={disable:[],enable:[],delete:[]},t.main=n,t.search=d,t.controller=o,t.viewer=t.parentNode.parentNode,t.loader=i,t.table=t.parentNode,t.apply=c,t.paginate=a,t.currentPage=1,t.viewer.appendChild(a),this.cachePoints["_"+e]=t},close(e){e.classList.add("closed")},open(e){e.classList.remove("closed")},isOpen(e){const t=this.getCachePoint(e);let n=!1;return t&&(n=t.controller.checked&&t.main.checked),n},_bind(e){const t=e.dataset.cachePoint;this.setCachePoint(t,e),this._handleManager(t)},_handleManager(e){const t=this.getCachePoint(e);t&&(this.isOpen(e)?(this.open(t.viewer),this.states.set(t.viewer.id,"open"),t.loaded||this._load(e)):(this.close(t.viewer),t.controller.checked=!1,this.states.set(t.viewer.id,"close")))},_load(t){const n=this.getCachePoint(t);let a="100px";n.clientHeight&&(a=n.clientHeight-16+"px"),this._clearChildren(n),n.appendChild(n.loader),this.open(n.loader),n.loader.firstChild.style.height=a,(0,e.default)({path:CLDASSETS.fetch_url,data:{ID:t,page:n.currentPage,search:n.search.value},method:"POST"}).then(e=>{n.removeChild(n.loader),this._buildList(n,e.items),this._buildNav(n,e);const t=n.querySelectorAll("[data-main]");i.default.bind(t),n.loaded=!0})},_cacheChange(e,t){const n=t.checked?t.states.on:t.states.off,a=t.checked?t.states.off:t.states.on;this._removeFromList(e,t.item.ID,a)||this._addToList(e,t.item.ID,n),this._evaluateApply(e)},_evaluateApply(e){e.apply.disabled="disabled";const t=e.apply.cacheChanges;let n=!1;for(const e in t)t[e].length&&(n=!0);n&&(e.apply.disabled="")},_applyChanges(e){const t=e.apply.cacheChanges;e.apply.disabled="disabled";for(const n in t)t[n].length&&this._set_state(e,n,t[n])},_watchPurge(t){t.dataset.purging||t.dataset.updating||(t.dataset.updating=!0,(0,e.default)({path:CLDASSETS.purge_all,data:{count:!0},method:"POST"}).then(e=>{t.dataset.updating="",0<e.percent&&100>e.percent?(t.disabled="",this._purgeAll(t,!0)):0<e.pending?t.disabled="":t.disabled="disabled"}))},_purgeAll(e,n,a){e.blur();e.dataset.purging=!0,e.style.width="200px",e.style.border="0",e.dataset.title=e.innerText,e.innerText=(0,t.__)("Purging cache 0%","cloudinary"),e.style.backgroundImage="linear-gradient(90deg, #2a0 0%, #787878 0%)",this._purgeAction(e,n,a)},_purgeAction(n,a,i){const s=n.dataset.parent;(0,e.default)({path:CLDASSETS.purge_all,data:{count:a,parent:s},method:"POST"}).then(e=>{n.innerText=(0,t.__)("Purging cache","cloudinary")+" "+Math.round(e.percent,2)+"%",n.style.backgroundImage="linear-gradient(90deg, #2a0 "+e.percent+"%, #787878 "+e.percent+"%)",100>e.percent?this._purgeAction(n,!0,i):i?i():(n.innerText=wp.i18n.__("Purge complete.","cloudinary"),setTimeout(()=>{n.dataset.purging="",n.style.backgroundImage="",n.style.minHeight="",n.style.border="",n.style.width="100px",n.disabled="disabled",n.innerText=n.dataset.title},2e3))})},_set_state(t,n,a){this._showSpinners(a),(0,e.default)({path:CLDASSETS.update_url,data:{state:n,ids:a},method:"POST"}).then(e=>{this._hideSpinners(e),e.forEach(e=>{this._removeFromList(t,e,n),this._evaluateApply(t),t.apply.disabled="disabled"}),"delete"===n&&this._load(t.dataset.cachePoint)})},_showSpinners(e){e.forEach(e=>{this.spinners["spinner_"+e].style.visibility="visible"})},_hideSpinners(e){e.forEach(e=>{this.spinners["spinner_"+e].style.visibility="hidden"})},_removeFromList(e,t,n){const a=this._getListIndex(e,t,n);let i=!1;return-1<a&&(e.apply.cacheChanges[n].splice(a,1),i=!0),i},_addToList(e,t,n){-1===this._getListIndex(e,t,n)&&e.apply.cacheChanges[n].push(t)},_getListIndex:(e,t,n)=>e.apply.cacheChanges[n].indexOf(t),_noCache(e){const t=this._getNote(wp.i18n.__("No files cached.","cloudinary"));e.viewer.appendChild(t),this.close(e.table)},_clearChildren(e){for(;e.children.length;){const t=e.lastChild;t.children.length&&this._clearChildren(t),e.removeChild(t)}},_buildList(e,t){t.forEach(t=>{if(t.note)return void e.appendChild(this._getNote(t.note));const n=this._getRow(t.ID),a=this._getStateSwitch(e,t,{on:"enable",off:"disable"}),i=this._getFile(e,t,n),s=this._getEdit(t,e);n.appendChild(i),n.appendChild(s),n.appendChild(a),e.appendChild(n)})},_buildNav(e,t){e.paginate.innerHTML="";const n=document.createElement("button"),a=document.createElement("button");n.type="button",n.innerHTML="&lsaquo;",n.className="button cld-pagenav-prev",1===t.current_page?n.disabled=!0:n.addEventListener("click",n=>{e.currentPage=t.current_page-1,this._load(e.dataset.cachePoint)}),a.type="button",a.innerHTML="&rsaquo;",a.className="button cld-pagenav-next",t.current_page===t.total_pages||0===t.total_pages?a.disabled=!0:a.addEventListener("click",n=>{e.currentPage=t.current_page+1,this._load(e.dataset.cachePoint)});const i=document.createElement("span");if(i.innerText=t.nav_text,i.className="cld-pagenav-text",e.paginate.appendChild(n),e.paginate.appendChild(i),e.paginate.appendChild(a),e.paginate.appendChild(e.apply),e.apply.classList.remove("closed"),e.apply.disabled="disabled",t.items.length){const t=document.createElement("button");t.type="button",t.className="button",t.innerText=wp.i18n.__("Purge cache point","cloudinary"),t.style.float="right",e.paginate.appendChild(t),t.addEventListener("click",n=>{if(confirm(wp.i18n.__("Purge entire cache point?","cloudinary"))){t.dataset.parent=e.dataset.cachePoint;const n=this;t.classList.add("button-primary"),this._purgeAll(t,!1,function(){n._load(e.dataset.cachePoint)})}})}},_getNote(e){const t=this._getRow(),n=document.createElement("td");return n.colSpan=2,n.innerText=e,t.appendChild(n),t},_getRow(e){const t=document.createElement("tr");return e&&(t.id="row_"+e),t},_getEdit(e){const n=document.createElement("td"),a=document.createElement("a");return a.href=e.edit_url,e.data.transformations?a.innerText=e.data.transformations:a.innerText=(0,t.__)("Add transformations","cloudinary"),n.appendChild(a),n},_getFile(e,t){const n=document.createElement("td"),a=document.createElement("label"),i=this._getDeleter(e,n,t);a.innerText=t.short_url,a.htmlFor=t.key,n.appendChild(i),n.appendChild(a);const s=document.createElement("span"),d="spinner_"+t.ID;return s.className="spinner",s.id=d,n.appendChild(s),this.spinners[d]=s,n},_getDeleter(e,t,n){const a=document.createElement("input"),i=[e.dataset.slug+"_deleter"],s=this._getListIndex(e,n.ID,"delete");return a.type="checkbox",a.value=n.ID,a.id=n.key,a.dataset.main=JSON.stringify(i),-1<s&&(a.checked=!0,t.style.textDecoration="line-through"),a.addEventListener("change",i=>{t.style.opacity=1,t.style.textDecoration="",a.checked&&(t.style.opacity=.8,t.style.textDecoration="line-through");const s=new CustomEvent("CacheToggle",{detail:{checked:a.checked,states:{on:"delete",off:n.active?"enable":"disable"},item:n,cachePoint:e}});window.dispatchEvent(s)}),a},_getStateSwitch(e,t,n){const a=document.createElement("td"),i=document.createElement("label"),s=document.createElement("input"),d=document.createElement("span"),l=(e.dataset.slug,this._getListIndex(e,t.ID,"disable"));return a.style.textAlign="right",i.className="cld-input-on-off-control mini",s.type="checkbox",s.value=t.ID,s.checked=!(-1<l)&&t.active,d.className="cld-input-on-off-control-slider",i.appendChild(s),i.appendChild(d),s.addEventListener("change",a=>{const i=new CustomEvent("CacheToggle",{detail:{checked:s.checked,states:n,item:t,cachePoint:e}});window.dispatchEvent(i)}),a.appendChild(i),a}},l=document.getElementById("cloudinary-settings-page");l&&(s.default.init(),window.addEventListener("load",()=>d.init(l,s.default)))})()})();
//# sourceMappingURL=asset-manager.js.map