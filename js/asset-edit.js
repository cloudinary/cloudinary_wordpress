(()=>{"use strict";var t,e,r,n;t={"(":9,"!":8,"*":7,"/":7,"%":7,"+":6,"-":6,"<":5,"<=":5,">":5,">=":5,"==":4,"!=":4,"&&":3,"||":2,"?":1,"?:":1},e=["(","?"],r={")":["("],":":["?","?:"]},n=/<=|>=|==|!=|&&|\|\||\?:|\(|!|\*|\/|%|\+|-|<|>|\?|\)|:/;var i={"!":function(t){return!t},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"<":function(t,e){return t<e},"<=":function(t,e){return t<=e},">":function(t,e){return t>e},">=":function(t,e){return t>=e},"==":function(t,e){return t===e},"!=":function(t,e){return t!==e},"&&":function(t,e){return t&&e},"||":function(t,e){return t||e},"?:":function(t,e,r){if(t)throw e;return r}};function s(s){var o=function(i){for(var s,o,a,l,c=[],u=[];s=i.match(n);){for(o=s[0],(a=i.substr(0,s.index).trim())&&c.push(a);l=u.pop();){if(r[o]){if(r[o][0]===l){o=r[o][1]||o;break}}else if(e.indexOf(l)>=0||t[l]<t[o]){u.push(l);break}c.push(l)}r[o]||u.push(o),i=i.substr(s.index+o.length)}return(i=i.trim())&&c.push(i),c.concat(u.reverse())}(s);return function(t){return function(t,e){var r,n,s,o,a,l,c=[];for(r=0;r<t.length;r++){if(a=t[r],o=i[a]){for(n=o.length,s=Array(n);n--;)s[n]=c.pop();try{l=o.apply(null,s)}catch(t){return t}}else l=e.hasOwnProperty(a)?e[a]:+a;c.push(l)}return c[0]}(o,t)}}var o={contextDelimiter:"",onMissingKey:null};function a(t,e){var r;for(r in this.data=t,this.pluralForms={},this.options={},o)this.options[r]=void 0!==e&&r in e?e[r]:o[r]}a.prototype.getPluralForm=function(t,e){var r,n,i,o=this.pluralForms[t];return o||("function"!=typeof(i=(r=this.data[t][""])["Plural-Forms"]||r["plural-forms"]||r.plural_forms)&&(n=function(t){var e,r,n;for(e=t.split(";"),r=0;r<e.length;r++)if(0===(n=e[r].trim()).indexOf("plural="))return n.substr(7)}(r["Plural-Forms"]||r["plural-forms"]||r.plural_forms),i=function(t){var e=s(t);return function(t){return+e({n:t})}}(n)),o=this.pluralForms[t]=i),o(e)},a.prototype.dcnpgettext=function(t,e,r,n,i){var s,o,a;return s=void 0===i?0:this.getPluralForm(t,i),o=r,e&&(o=e+this.options.contextDelimiter+r),(a=this.data[t][o])&&a[s]?a[s]:(this.options.onMissingKey&&this.options.onMissingKey(r,t),0===s?r:n)};var l={plural_forms:t=>1===t?0:1},c=/^i18n\.(n?gettext|has_translation)(_|$)/;var u=function(t){return"string"!=typeof t||""===t?(console.error("The namespace must be a non-empty string."),!1):!!/^[a-zA-Z][a-zA-Z0-9_.\-\/]*$/.test(t)||(console.error("The namespace can only contain numbers, letters, dashes, periods, underscores and slashes."),!1)};var h=function(t){return"string"!=typeof t||""===t?(console.error("The hook name must be a non-empty string."),!1):/^__/.test(t)?(console.error("The hook name cannot begin with `__`."),!1):!!/^[a-zA-Z][a-zA-Z0-9_.-]*$/.test(t)||(console.error("The hook name can only contain numbers, letters, dashes, periods and underscores."),!1)};var d=function(t,e){return function(r,n,i,s=10){const o=t[e];if(!h(r))return;if(!u(n))return;if("function"!=typeof i)return void console.error("The hook callback must be a function.");if("number"!=typeof s)return void console.error("If specified, the hook priority must be a number.");const a={callback:i,priority:s,namespace:n};if(o[r]){const t=o[r].handlers;let e;for(e=t.length;e>0&&!(s>=t[e-1].priority);e--);e===t.length?t[e]=a:t.splice(e,0,a),o.__current.forEach(t=>{t.name===r&&t.currentIndex>=e&&t.currentIndex++})}else o[r]={handlers:[a],runs:0};"hookAdded"!==r&&t.doAction("hookAdded",r,n,i,s)}};var p=function(t,e,r=!1){return function(n,i){const s=t[e];if(!h(n))return;if(!r&&!u(i))return;if(!s[n])return 0;let o=0;if(r)o=s[n].handlers.length,s[n]={runs:s[n].runs,handlers:[]};else{const t=s[n].handlers;for(let e=t.length-1;e>=0;e--)t[e].namespace===i&&(t.splice(e,1),o++,s.__current.forEach(t=>{t.name===n&&t.currentIndex>=e&&t.currentIndex--}))}return"hookRemoved"!==n&&t.doAction("hookRemoved",n,i),o}};var f=function(t,e){return function(r,n){const i=t[e];return void 0!==n?r in i&&i[r].handlers.some(t=>t.namespace===n):r in i}};var m=function(t,e,r,n){return function(i,...s){const o=t[e];o[i]||(o[i]={handlers:[],runs:0}),o[i].runs++;const a=o[i].handlers;if(!a||!a.length)return r?s[0]:void 0;const l={name:i,currentIndex:0};return(n?async function(){try{o.__current.add(l);let t=r?s[0]:void 0;for(;l.currentIndex<a.length;){const e=a[l.currentIndex];t=await e.callback.apply(null,s),r&&(s[0]=t),l.currentIndex++}return r?t:void 0}finally{o.__current.delete(l)}}:function(){try{o.__current.add(l);let t=r?s[0]:void 0;for(;l.currentIndex<a.length;){t=a[l.currentIndex].callback.apply(null,s),r&&(s[0]=t),l.currentIndex++}return r?t:void 0}finally{o.__current.delete(l)}})()}};var y=function(t,e){return function(){const r=t[e],n=Array.from(r.__current);return n.at(-1)?.name??null}};var v=function(t,e){return function(r){const n=t[e];return void 0===r?n.__current.size>0:Array.from(n.__current).some(t=>t.name===r)}};var w=function(t,e){return function(r){const n=t[e];if(h(r))return n[r]&&n[r].runs?n[r].runs:0}},g=class{actions;filters;addAction;addFilter;removeAction;removeFilter;hasAction;hasFilter;removeAllActions;removeAllFilters;doAction;doActionAsync;applyFilters;applyFiltersAsync;currentAction;currentFilter;doingAction;doingFilter;didAction;didFilter;constructor(){this.actions=Object.create(null),this.actions.__current=new Set,this.filters=Object.create(null),this.filters.__current=new Set,this.addAction=d(this,"actions"),this.addFilter=d(this,"filters"),this.removeAction=p(this,"actions"),this.removeFilter=p(this,"filters"),this.hasAction=f(this,"actions"),this.hasFilter=f(this,"filters"),this.removeAllActions=p(this,"actions",!0),this.removeAllFilters=p(this,"filters",!0),this.doAction=m(this,"actions",!1,!1),this.doActionAsync=m(this,"actions",!1,!0),this.applyFilters=m(this,"filters",!0,!1),this.applyFiltersAsync=m(this,"filters",!0,!0),this.currentAction=y(this,"actions"),this.currentFilter=y(this,"filters"),this.doingAction=v(this,"actions"),this.doingFilter=v(this,"filters"),this.didAction=w(this,"actions"),this.didFilter=w(this,"filters")}};var _=function(){return new g}(),{addAction:b,addFilter:x,removeAction:A,removeFilter:F,hasAction:I,hasFilter:E,removeAllActions:k,removeAllFilters:O,doAction:T,doActionAsync:P,applyFilters:j,applyFiltersAsync:L,currentAction:C,currentFilter:S,doingAction:R,doingFilter:D,didAction:U,didFilter:N,actions:$,filters:z}=_,M=((t,e,r)=>{const n=new a({}),i=new Set,s=()=>{i.forEach(t=>t())},o=(t,e="default")=>{n.data[e]={...n.data[e],...t},n.data[e][""]={...l,...n.data[e]?.[""]},delete n.pluralForms[e]},u=(t,e)=>{o(t,e),s()},h=(t="default",e,r,i,s)=>(n.data[t]||o(void 0,t),n.dcnpgettext(t,e,r,i,s)),d=t=>t||"default",p=(t,e,n)=>{let i=h(n,e,t);return r?(i=r.applyFilters("i18n.gettext_with_context",i,t,e,n),r.applyFilters("i18n.gettext_with_context_"+d(n),i,t,e,n)):i};if(t&&u(t,e),r){const t=t=>{c.test(t)&&s()};r.addAction("hookAdded","core/i18n",t),r.addAction("hookRemoved","core/i18n",t)}return{getLocaleData:(t="default")=>n.data[t],setLocaleData:u,addLocaleData:(t,e="default")=>{n.data[e]={...n.data[e],...t,"":{...l,...n.data[e]?.[""],...t?.[""]}},delete n.pluralForms[e],s()},resetLocaleData:(t,e)=>{n.data={},n.pluralForms={},u(t,e)},subscribe:t=>(i.add(t),()=>i.delete(t)),__:(t,e)=>{let n=h(e,void 0,t);return r?(n=r.applyFilters("i18n.gettext",n,t,e),r.applyFilters("i18n.gettext_"+d(e),n,t,e)):n},_x:p,_n:(t,e,n,i)=>{let s=h(i,void 0,t,e,n);return r?(s=r.applyFilters("i18n.ngettext",s,t,e,n,i),r.applyFilters("i18n.ngettext_"+d(i),s,t,e,n,i)):s},_nx:(t,e,n,i,s)=>{let o=h(s,i,t,e,n);return r?(o=r.applyFilters("i18n.ngettext_with_context",o,t,e,n,i,s),r.applyFilters("i18n.ngettext_with_context_"+d(s),o,t,e,n,i,s)):o},isRTL:()=>"rtl"===p("ltr","text direction"),hasTranslation:(t,e,i)=>{const s=e?e+""+t:t;let o=!!n.data?.[i??"default"]?.[s];return r&&(o=r.applyFilters("i18n.has_translation",o,t,e,i),o=r.applyFilters("i18n.has_translation_"+d(i),o,t,e,i)),o}}})(void 0,void 0,_),B=(M.getLocaleData.bind(M),M.setLocaleData.bind(M),M.resetLocaleData.bind(M),M.subscribe.bind(M),M.__.bind(M));M._x.bind(M),M._n.bind(M),M._nx.bind(M),M.isRTL.bind(M),M.hasTranslation.bind(M);const H={preview:null,wrap:null,apply:null,url:null,defaultWidth:null,defaultHeight:null,maxSize:null,init(){return this},createPreview(t=400,e=300){return this.maxSize=t>e?t:e,this.defaultWidth=t,this.defaultHeight=e,this.wrap=document.createElement("div"),this.apply=document.createElement("button"),this.preview=document.createElement("img"),this.apply.type="button",this.apply.classList.add("button-primary"),this.apply.innerText=B("Preview","cloudinary"),this.preview.style.transition="opacity 1s",this.preview.style.opacity=1,this.preview.style.maxWidth="100%",this.preview.style.maxHeight="100%",this.reset(),this.wrap.style.minHeight="200px",this.wrap.style.width=this.maxSize+"px",this.wrap.style.position="relative",this.wrap.style.display="flex",this.wrap.style.alignItems="center",this.wrap.style.justifyContent="center",this.apply.style.position="absolute",this.apply.style.display="none",this.wrap.appendChild(this.preview),this.wrap.appendChild(this.apply),this.preview.addEventListener("load",t=>{this.preview.style.opacity=1,this.wrap.style.width="",this.wrap.style.height="",this.defaultHeight=this.preview.height,this.defaultWidth=this.preview.width,this.defaultHeight>this.defaultWidth?this.wrap.style.height=this.maxSize+"px":this.wrap.style.width=this.maxSize+"px"}),this.preview.addEventListener("error",t=>{this.preview.src=this.getNoURL("⚠")}),this.apply.addEventListener("click",()=>{this.apply.style.display="none",this.reset(),this.preview.style.opacity=.6,this.preview.src=this.url}),this.wrap},reset(){this.preview.src=this.getNoURL()},setSrc(t,e=!1){this.preview.style.opacity=.6,e?(this.apply.style.display="none",this.preview.src=t):(this.apply.style.display="block",this.url=t)},getNoURL(t="︎"){const e=this.defaultWidth/2-23,r=this.defaultHeight/2+25;return`data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="${this.defaultWidth}" height="${this.defaultHeight}"><style>.error { font: normal 50px sans-serif; fill:rgb(255,0,0); }</style><rect width="100%" height="100%" style="fill:rgba(0,0,0,0.2);"></rect><text x="${e}" y="${r}" class="error">${t}</text></svg>`}};var W=function(t){const e=(t,r)=>{const{headers:n={}}=t;for(const i in n)if("x-wp-nonce"===i.toLowerCase()&&n[i]===e.nonce)return r(t);return r({...t,headers:{...n,"X-WP-Nonce":e.nonce}})};return e.nonce=t,e},J=(t,e)=>{let r,n,i=t.path;return"string"==typeof t.namespace&&"string"==typeof t.endpoint&&(r=t.namespace.replace(/^\/|\/$/g,""),n=t.endpoint.replace(/^\//,""),i=n?r+"/"+n:r),delete t.namespace,delete t.endpoint,e({...t,path:i})},K=t=>(e,r)=>J(e,e=>{let n,i=e.url,s=e.path;return"string"==typeof s&&(n=t,-1!==t.indexOf("?")&&(s=s.replace("?","&")),s=s.replace(/^\//,""),"string"==typeof n&&-1!==n.indexOf("?")&&(s=s.replace("?","&")),i=n+s),r({...e,url:i})});function Z(t){const e=t.split("?"),r=e[1],n=e[0];return r?n+"?"+r.split("&").map(t=>t.split("=")).map(t=>t.map(decodeURIComponent)).sort((t,e)=>t[0].localeCompare(e[0])).map(t=>t.map(encodeURIComponent)).map(t=>t.join("=")).join("&"):n}function G(t){try{return decodeURIComponent(t)}catch(e){return t}}function X(t){return(function(t){let e;try{e=new URL(t,"http://example.com").search.substring(1)}catch(t){}if(e)return e}(t)||"").replace(/\+/g,"%20").split("&").reduce((t,e)=>{const[r,n=""]=e.split("=").filter(Boolean).map(G);if(r){!function(t,e,r){const n=e.length,i=n-1;for(let s=0;s<n;s++){let n=e[s];!n&&Array.isArray(t)&&(n=t.length.toString()),n=["__proto__","constructor","prototype"].includes(n)?n.toUpperCase():n;const o=!isNaN(Number(e[s+1]));t[n]=s===i?r:t[n]||(o?[]:{}),Array.isArray(t[n])&&!o&&(t[n]={...t[n]}),t=t[n]}}(t,r.replace(/\]/g,"").split("["),n)}return t},Object.create(null))}function q(t){let e="";const r=Object.entries(t);let n;for(;n=r.shift();){let[t,i]=n;if(Array.isArray(i)||i&&i.constructor===Object){const e=Object.entries(i).reverse();for(const[n,i]of e)r.unshift([`${t}[${n}]`,i])}else void 0!==i&&(null===i&&(i=""),e+="&"+[t,String(i)].map(encodeURIComponent).join("="))}return e.substr(1)}function Q(t="",e){if(!e||!Object.keys(e).length)return t;const r=function(t){const e=/^\S+?(#[^\s\?]*)/.exec(t);if(e)return e[1]}(t)||"";let n=t.replace(r,"");const i=t.indexOf("?");return-1!==i&&(e=Object.assign(X(t),e),n=n.substr(0,i)),n+"?"+q(e)+r}function V(t,e){if(e)return Promise.resolve(t.body);try{return Promise.resolve(new window.Response(JSON.stringify(t.body),{status:200,statusText:"OK",headers:t.headers}))}catch{return Object.entries(t.headers).forEach(([e,r])=>{"link"===e.toLowerCase()&&(t.headers[e]=r.replace(/<([^>]+)>/,(t,e)=>`<${encodeURI(e)}>`))}),Promise.resolve(e?t.body:new window.Response(JSON.stringify(t.body),{status:200,statusText:"OK",headers:t.headers}))}}var Y=function(t){const e=Object.fromEntries(Object.entries(t).map(([t,e])=>[Z(t),e]));return(t,r)=>{const{parse:n=!0}=t;let i=t.path;if(!i&&t.url){const{rest_route:e,...r}=X(t.url);"string"==typeof e&&(i=Q(e,r))}if("string"!=typeof i)return r(t);const s=t.method||"GET",o=Z(i);if("GET"===s&&e[o]){const t=e[o];return delete e[o],V(t,!!n)}if("OPTIONS"===s&&e[s]&&e[s][o]){const t=e[s][o];return delete e[s][o],V(t,!!n)}return r(t)}},tt=({path:t,url:e,...r},n)=>({...r,url:e&&Q(e,n),path:t&&Q(t,n)}),et=t=>t.json?t.json():Promise.reject(t),rt=t=>{const{next:e}=(t=>{if(!t)return{};const e=t.match(/<([^>]+)>; rel="next"/);return e?{next:e[1]}:{}})(t.headers.get("link"));return e},nt=async(t,e)=>{if(!1===t.parse)return e(t);if(!(t=>{const e=!!t.path&&-1!==t.path.indexOf("per_page=-1"),r=!!t.url&&-1!==t.url.indexOf("per_page=-1");return e||r})(t))return e(t);const r=await gt({...tt(t,{per_page:100}),parse:!1}),n=await et(r);if(!Array.isArray(n))return n;let i=rt(r);if(!i)return n;let s=[].concat(n);for(;i;){const e=await gt({...t,path:void 0,url:i,parse:!1}),r=await et(e);s=s.concat(r),i=rt(e)}return s},it=new Set(["PATCH","PUT","DELETE"]),st="GET";function ot(t,e){return X(t)[e]}function at(t,e){return void 0!==ot(t,e)}async function lt(t){try{return await t.json()}catch{throw{code:"invalid_json",message:B("The response is not a valid JSON response.")}}}async function ct(t,e=!0){return e?204===t.status?null:await lt(t):t}async function ut(t,e=!0){if(!e)throw t;throw await lt(t)}var ht=(t,e)=>{if(!function(t){const e=!!t.method&&"POST"===t.method;return(!!t.path&&-1!==t.path.indexOf("/wp/v2/media")||!!t.url&&-1!==t.url.indexOf("/wp/v2/media"))&&e}(t))return e(t);let r=0;const n=t=>(r++,e({path:`/wp/v2/media/${t}/post-process`,method:"POST",data:{action:"create-image-subsizes"},parse:!1}).catch(()=>r<5?n(t):(e({path:`/wp/v2/media/${t}?force=true`,method:"DELETE"}),Promise.reject())));return e({...t,parse:!1}).catch(e=>{if(!(e instanceof globalThis.Response))return Promise.reject(e);const r=e.headers.get("x-wp-upload-attachment-id");return e.status>=500&&e.status<600&&r?n(r).catch(()=>!1!==t.parse?Promise.reject({code:"post_process",message:B("Media upload failed. If this is a photo or a large image, please scale it down and try again.")}):Promise.reject(e)):ut(e,t.parse)}).then(e=>ct(e,t.parse))};function dt(t,...e){const r=t.replace(/^[^#]*/,""),n=(t=t.replace(/#.*/,"")).indexOf("?");if(-1===n)return t+r;const i=X(t),s=t.substr(0,n);e.forEach(t=>delete i[t]);const o=q(i);return(o?s+"?"+o:s)+r}var pt=t=>(e,r)=>{if("string"==typeof e.url){const r=ot(e.url,"wp_theme_preview");void 0===r?e.url=Q(e.url,{wp_theme_preview:t}):""===r&&(e.url=dt(e.url,"wp_theme_preview"))}if("string"==typeof e.path){const r=ot(e.path,"wp_theme_preview");void 0===r?e.path=Q(e.path,{wp_theme_preview:t}):""===r&&(e.path=dt(e.path,"wp_theme_preview"))}return r(e)},ft={Accept:"application/json, */*;q=0.1"},mt={credentials:"include"},yt=[(t,e)=>("string"!=typeof t.url||at(t.url,"_locale")||(t.url=Q(t.url,{_locale:"user"})),"string"!=typeof t.path||at(t.path,"_locale")||(t.path=Q(t.path,{_locale:"user"})),e(t)),J,(t,e)=>{const{method:r=st}=t;return it.has(r.toUpperCase())&&(t={...t,headers:{...t.headers,"X-HTTP-Method-Override":r,"Content-Type":"application/json"},method:"POST"}),e(t)},nt];var vt=t=>{const{url:e,path:r,data:n,parse:i=!0,...s}=t;let{body:o,headers:a}=t;a={...ft,...a},n&&(o=JSON.stringify(n),a["Content-Type"]="application/json");return globalThis.fetch(e||r||window.location.href,{...mt,...s,body:o,headers:a}).then(t=>t.ok?ct(t,i):ut(t,i),t=>{if(t&&"AbortError"===t.name)throw t;if(!globalThis.navigator.onLine)throw{code:"offline_error",message:B("Unable to connect. Please check your Internet connection.")};throw{code:"fetch_error",message:B("Could not get a valid response from the server.")}})};var wt=t=>yt.reduceRight((t,e)=>r=>e(r,t),vt)(t).catch(e=>"rest_cookie_invalid_nonce"!==e.code?Promise.reject(e):globalThis.fetch(wt.nonceEndpoint).then(t=>t.ok?t.text():Promise.reject(e)).then(e=>(wt.nonceMiddleware.nonce=e,wt(t))));wt.use=function(t){yt.unshift(t)},wt.setFetchHandler=function(t){vt=t},wt.createNonceMiddleware=W,wt.createPreloadingMiddleware=Y,wt.createRootURLMiddleware=K,wt.fetchAllMiddleware=nt,wt.mediaUploadMiddleware=ht,wt.createThemePreviewMiddleware=pt;var gt=wt;const _t={id:null,post_id:null,transformations:null,beforeCallbacks:[],completeCallbacks:[],init(t){if(void 0!==cldData.editor)return gt.use(gt.createNonceMiddleware(cldData.editor.nonce)),this.callback=t,this},save(t){this.doBefore(t),gt({path:cldData.editor.save_url,data:t,method:"POST"}).then(t=>{this.doComplete(t,this)})},doBefore(t){this.beforeCallbacks.forEach(e=>e(t,this))},doComplete(t){this.completeCallbacks.forEach(e=>e(t,this))},onBefore(t){this.beforeCallbacks.push(t)},onComplete(t){this.completeCallbacks.push(t)}},bt={wrap:document.getElementById("cld-asset-edit"),preview:null,id:null,editor:null,base:null,publicId:null,size:null,transformationsInput:document.getElementById("cld-asset-edit-transformations"),saveButton:document.getElementById("cld-asset-edit-save"),currentURL:null,init(){const t=JSON.parse(this.wrap.dataset.item);this.id=t.ID,this.base=t.base+t.size+"/",this.publicId=t.file,this.transformationsInput.value=t.transformations?t.transformations:"",this.initPreview(),this.initEditor()},initPreview(){this.preview=H.init(),this.wrap.appendChild(this.preview.createPreview(900,675)),this.preview.setSrc(this.base+this.transformationsInput.value+this.publicId,!0),this.transformationsInput.addEventListener("input",t=>{this.preview.setSrc(this.base+this.transformationsInput.value+this.publicId)}),this.transformationsInput.addEventListener("keydown",t=>{"Enter"===t.code&&(t.preventDefault(),this.saveButton.dispatchEvent(new Event("click")))})},initEditor(){this.editor=_t.init(),this.editor.onBefore(()=>this.preview.reset()),this.editor.onComplete(t=>{this.transformationsInput.value=t.transformations,this.preview.setSrc(this.base+t.transformations+this.publicId,!0),t.note&&alert(t.note)}),this.saveButton.addEventListener("click",()=>{this.editor.save({ID:this.id,transformations:this.transformationsInput.value})})}};window.addEventListener("load",()=>bt.init())})();
//# sourceMappingURL=asset-edit.js.map