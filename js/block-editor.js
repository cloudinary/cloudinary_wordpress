!function(){"use strict";var e=window.React,t=window.wp.i18n,r=window.wp.data,i=window.wp.components;const o={_init(){"undefined"!=typeof CLD_VIDEO_PLAYER&&wp.hooks.addFilter("blocks.registerBlockType","Cloudinary/Media/Video",(function(e,t){return"core/video"===t&&("off"!==CLD_VIDEO_PLAYER.video_autoplay_mode&&(e.attributes.autoplay.default=!0),"on"===CLD_VIDEO_PLAYER.video_loop&&(e.attributes.loop.default=!0),"off"===CLD_VIDEO_PLAYER.video_controls&&(e.attributes.controls.default=!1)),e}))}};o._init();wp.hooks.addFilter("blocks.registerBlockType","cloudinary/addAttributes",(function(e,t){return"core/image"!==t&&"core/video"!==t||(e.attributes||(e.attributes={}),e.attributes.overwrite_transformations={type:"boolean"},e.attributes.transformations={type:"boolean"}),e}));const a=r=>{const{attributes:{overwrite_transformations:o},setAttributes:a}=r;return(0,e.createElement)(i.PanelBody,{title:(0,t.__)("Transformations","cloudinary")},(0,e.createElement)(i.ToggleControl,{label:(0,t.__)("Overwrite Global Transformations","cloudinary"),checked:o,onChange:e=>{a({overwrite_transformations:e})}}))};let n=t=>{const{setAttributes:r,media:i}=t,{InspectorControls:o}=wp.editor;return i&&i.transformations&&r({transformations:!0}),(0,e.createElement)(o,null,(0,e.createElement)(a,{...t}))};n=(0,r.withSelect)(((e,t)=>({...t,media:t.attributes.id?e("core").getMedia(t.attributes.id):null})))(n);wp.hooks.addFilter("editor.BlockEdit","cloudinary/filterEdit",(t=>r=>{const{name:i}=r,o="core/image"===i||"core/video"===i;return(0,e.createElement)(e.Fragment,null,o?(0,e.createElement)(n,{...r}):null,(0,e.createElement)(t,{...r}))}),20);let s=r=>(0,e.createElement)(e.Fragment,null,r.modalClass&&(0,e.createElement)(i.ToggleControl,{label:(0,t.__)("Overwrite Cloudinary Global Transformations","cloudinary"),checked:r.overwrite_featured_transformations,onChange:e=>r.setOverwrite(e),className:"cloudinary-overwrite-transformations"}));s=(0,r.withSelect)((e=>{var t;return{overwrite_featured_transformations:null!==(t=e("core/editor")?.getEditedPostAttribute("meta")._cloudinary_featured_overwrite)&&void 0!==t&&t}}))(s),s=(0,r.withDispatch)((e=>({setOverwrite:t=>{e("core/editor").editPost({meta:{_cloudinary_featured_overwrite:t}})}})))(s);const l=t=>class extends t{render(){return(0,e.createElement)(e.Fragment,null,super.render(),!!this.props.value&&(0,e.createElement)(s,{...this.props}))}},d={_init(){wp.hooks.addFilter("editor.MediaUpload","cloudinary/filter-featured-image",l)}};d._init();const c={wrapper:null,query:{per_page:-1,orderby:"name",order:"asc",_fields:"id,name,parent",context:"view"},available:{},taxonomies:null,fetchWait:null,_init(){this.wrapper=document.getElementById("cld-tax-items");const{getTaxonomies:e}=(0,r.select)("core");this.fetchWait=setInterval((()=>{this.taxonomies=e(),this.taxonomies&&(clearInterval(this.fetchWait),this._init_listeners())}),1e3)},_init_listeners(){this.taxonomies.forEach((e=>{e.rest_base&&e.visibility.public&&(0,r.subscribe)((()=>{const t=e.slug,i=e.hierarchical,{isResolving:o}=(0,r.select)("core/data"),a=["taxonomy",t,this.query];this.available[t]=null,i&&(this.available[t]=(0,r.select)("core").getEntityRecords("taxonomy",t,this.query)),o("core","getEntityRecords",a)||this.event(e)}))}))},event(e){const t=(0,r.select)("core/editor").getEditedPostAttribute(e.rest_base);if(!t)return;const i=[...t],o=Array.from(this.wrapper.querySelectorAll(`[data-item*="${e.slug}"]`));[...i].forEach((t=>{const r=this.wrapper.querySelector(`[data-item="${e.slug}:${t}"]`);o.splice(o.indexOf(r),1),null===r&&this.createItem(this.getItem(e,t))})),o.forEach((e=>{e.parentNode.removeChild(e)}))},createItem(e){if(!e||!e.id)return;const t=document.createElement("li"),r=document.createElement("span"),i=document.createElement("input"),o=document.createTextNode(e.name);t.classList.add("cld-tax-order-list-item"),t.dataset.item=`${e.taxonomy}:${e.id}`,i.classList.add("cld-tax-order-list-item-input"),i.type="hidden",i.name="cld_tax_order[]",i.value=`${e.taxonomy}:${e.id}`,r.className="dashicons dashicons-menu cld-tax-order-list-item-handle",t.appendChild(r),t.appendChild(i),t.appendChild(o),this.wrapper.appendChild(t)},getItem(e,t){let i={};if(null===this.available[e.slug])i=(0,r.select)("core").getEntityRecord("taxonomy",e.slug,t);else for(const r of this.available[e.slug])if(r.id===t){i=r,i.taxonomy=e.slug;break}return i}};window.addEventListener("load",(()=>c._init()));var u=window.wp.plugins,m=window.wp.element;const p=()=>{const e=(0,r.useSelect)((e=>e("core/editor").isSavingPost())),t=(0,r.useSelect)((e=>e("core/editor").isEditedPostDirty())),{storage:i}=window?.CLDN||null;(0,m.useEffect)((()=>{e&&!t&&"cld"===i&&window.location.reload()}),[e])};(0,u.registerPlugin)("cloudinary-maybe-reload-after-save",{render:p});window.$=window.jQuery}();